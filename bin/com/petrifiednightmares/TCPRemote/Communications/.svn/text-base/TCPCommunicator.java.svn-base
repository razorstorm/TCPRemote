package com.petrifiednightmares.TCPRemote.Communications;

import java.io.BufferedOutputStream;
import java.io.IOException;
import java.io.PrintWriter;
import java.io.Serializable;
import java.net.InetSocketAddress;
import java.net.Socket;
import java.net.SocketAddress;
import java.net.UnknownHostException;

public class TCPCommunicator implements Serializable
{
	/**
	 * 
	 */
	private static final long serialVersionUID = 505498261491712104L;

	private static Socket mainSocket;

	public static int PORT_NUMBER = 80;

	private static SocketAddress sockaddr;

	public TCPCommunicator()
	{

	}

	public static void setupSocket(String ip) throws UnknownHostException, IOException
	{
		sockaddr = new InetSocketAddress(ip, PORT_NUMBER);
		connectSocket();
	}

	private static void connectSocket() throws IOException
	{
		mainSocket = new Socket();
		mainSocket.setSoTimeout(3000);
		mainSocket.connect(sockaddr, 5000);
	}

	public static void destroySocket()
	{
		if(!mainSocket.isClosed())
		{
			try
			{
				mainSocket.close();
			}
			catch (IOException e)
			{
				//Doesn't matter, since we are destroying anyway lululululul
			}
		}
		mainSocket=null;
	}
	public static void sendMessage(String msg) throws IOException
	{
		if (mainSocket == null)
		{
			return;
		}
		if (!mainSocket.isConnected())
		{
			connectSocket();
		}
		BufferedOutputStream outputStream = (BufferedOutputStream) mainSocket.getOutputStream();
		PrintWriter output = new PrintWriter(outputStream);
		output.println(msg);
	}
}
